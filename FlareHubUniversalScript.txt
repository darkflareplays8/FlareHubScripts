-- ðŸ”¥ FlareHub V2 - STEAL A BRAINROT AUTO STEAL + UNIVERSAL
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "ðŸ”¥ FlareHub V2",
   LoadingTitle = "FlareHub V2",
   LoadingSubtitle = "Noclip â€¢ Fly â€¢ ESP â€¢ Walkspeed â€¢ Brainrot",
   ConfigurationSaving = { Enabled = true, FolderName = "FlareHub", FileName = "FlareConfig" },
   Discord = { Enabled = false },
   KeySystem = false
})

local Tab = Window:CreateTab("Main", 4483362458)
local BrainrotTab -- Will be created conditionally

local player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")

-- GAME DETECTION
local function isStealABrainrot()
   local gameName = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name:lower()
   return gameName:find("steal") and gameName:find("brainrot")
end

-- Create Brainrot Tab ONLY if in Steal a Brainrot
if isStealABrainrot() then
   BrainrotTab = Window:CreateTab("ðŸ§  Steal a Brainrot", 4483362458)
   
   -- AUTO STEAL BRAINROT
   BrainrotTab:CreateToggle({
      Name = "ðŸ¤– Auto Steal Brainrots",
      CurrentValue = false,
      Flag = "AutoStealToggle",
      Callback = function(Value)
         getgenv().AutoStealEnabled = Value
         if Value then
            spawn(function()
               while getgenv().AutoStealEnabled do
                  -- Find nearest stealable brainrot
                  local closestBrainrot = nil
                  local shortestDistance = math.huge
                  
                  for _, obj in pairs(workspace:GetDescendants()) do
                     if obj.Name:lower():find("brainrot") and obj:IsA("BasePart") and obj.Parent then
                        local distance = (obj.Position - player.Character.HumanoidRootPart.Position).Magnitude
                        if distance < shortestDistance then
                           closestBrainrot = obj
                           shortestDistance = distance
                        end
                     end
                  end
                  
                  if closestBrainrot and shortestDistance < 50 then
                     -- Teleport to brainrot and steal
                     player.Character.HumanoidRootPart.CFrame = closestBrainrot.CFrame * CFrame.new(0, 5, 0)
                     fireclickdetector(closestBrainrot:FindFirstChildOfClass("ClickDetector"))
                  end
                  
                  wait(0.1)
               end
            end)
         end
      end,
   })
   
   -- AUTO BASE BUILD
   BrainrotTab:CreateToggle({
      Name = "ðŸ—ï¸ Auto Base Build",
      CurrentValue = false,
      Flag = "AutoBuildToggle",
      Callback = function(Value)
         getgenv().AutoBuildEnabled = Value
      end,
   })
   
   -- ANTI RAGDOLL
   BrainrotTab:CreateToggle({
      Name = "ðŸ›¡ï¸ Anti Ragdoll",
      CurrentValue = false,
      Flag = "AntiRagdollToggle",
      Callback = function(Value)
         getgenv().AntiRagdoll = Value
         if player.Character then
            for _, part in pairs(player.Character:GetChildren()) do
               if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                  part.CanCollide = Value
               end
            end
         end
      end,
   })
   
   -- SPEED BOOST
   BrainrotTab:CreateSlider({
      Name = "ðŸš€ Speed Boost",
      Range = {16, 500},
      Increment = 10,
      CurrentValue = 50,
      Flag = "BrainrotSpeed",
      Callback = function(Value)
         local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
         if humanoid then humanoid.WalkSpeed = Value end
      end,
   })
end

-- MAIN TAB (Always visible)
Tab:CreateButton({ Name = "âœ… Test GUI", Callback = function() end })

Tab:CreateToggle({
   Name = "âœ¨ Noclip",
   CurrentValue = false,
   Flag = "NoclipToggle",
   Callback = function(Value)
      getgenv().NoclipEnabled = Value
      if Value then
         getgenv().NoclipConnection = RunService.Stepped:Connect(function()
            if player.Character then
               for _, part in pairs(player.Character:GetDescendants()) do
                  if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                     part.CanCollide = false
                  end
               end
            end
         end)
      else if getgenv().NoclipConnection then getgenv().NoclipConnection:Disconnect() end
      end
   end,
})

Tab:CreateSlider({
   Name = "Fly Speed",
   Range = {50, 300},
   Increment = 10,
   CurrentValue = 100,
   Flag = "FlySpeedSlider",
   Callback = function(Value) getgenv().FlySpeed = Value end,
})

-- SMOOTH FLY (same as before)
Tab:CreateToggle({
   Name = "ðŸ•Šï¸ Fly",
   CurrentValue = false,
   Flag = "FlyToggle",
   Callback = function(Value)
      getgenv().FlyEnabled = Value
      local character = player.Character or player.CharacterAdded:Wait()
      local humanoid = character:WaitForChild("Humanoid")
      local rootPart = character:WaitForChild("HumanoidRootPart")
      
      if Value then
         humanoid.PlatformStand = true
         rootPart.CFrame = rootPart.CFrame + Vector3.new(0, 10, 0)
         
         local bodyVelocity = Instance.new("BodyVelocity")
         bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
         bodyVelocity.Velocity = Vector3.new(0, 0, 0)
         bodyVelocity.Parent = rootPart
         
         local bodyGyro = Instance.new("BodyGyro")
         bodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
         bodyGyro.P = 3000
         bodyGyro.D = 500
         bodyGyro.CFrame = rootPart.CFrame
         bodyGyro.Parent = rootPart
         
         getgenv().FlyBodyVelocity = bodyVelocity
         getgenv().FlyBodyGyro = bodyGyro
         getgenv().lastVelocity = Vector3.new(0, 0, 0)
         
         getgenv().FlyConnection = RunService.Heartbeat:Connect(function()
            if not rootPart.Parent then return end
            
            local camera = workspace.CurrentCamera
            local camCFrame = camera.CFrame
            local moveDir = humanoid.MoveDirection
            local speed = getgenv().FlySpeed or 100
            
            local horizontalForward = Vector3.new(camCFrame.LookVector.X, 0, camCFrame.LookVector.Z)
            if horizontalForward.Magnitude > 0 then
               horizontalForward = horizontalForward.Unit
            else
               horizontalForward = Vector3.new(0, 0, -1)
            end
            
            local camRight = Vector3.new(camCFrame.RightVector.X, 0, camCFrame.RightVector.Z).Unit
            
            if moveDir.Magnitude > 0.05 then
               local horizontalMove = horizontalForward * -moveDir.Z + camRight * moveDir.X
               local verticalMove = Vector3.new(0, moveDir.Y * speed, 0)
               local targetVelocity = (horizontalMove * speed) + verticalMove
               
               local currentVelocity = getgenv().lastVelocity or Vector3.new(0, 0, 0)
               local lerpVelocity = currentVelocity:Lerp(targetVelocity, 0.15)
               
               bodyVelocity.Velocity = lerpVelocity
               getgenv().lastVelocity = lerpVelocity
            else
               local currentVelocity = getgenv().lastVelocity or Vector3.new(0, 0, 0)
               local lerpVelocity = currentVelocity:Lerp(Vector3.new(0, 0, 0), 0.15)
               
               bodyVelocity.Velocity = lerpVelocity
               getgenv().lastVelocity = lerpVelocity
            end
            
            bodyGyro.CFrame = CFrame.new(rootPart.Position, rootPart.Position + camCFrame.LookVector)
         end)
         
      else
         humanoid.PlatformStand = false
         if getgenv().FlyBodyVelocity then getgenv().FlyBodyVelocity:Destroy() end
         if getgenv().FlyBodyGyro then getgenv().FlyBodyGyro:Destroy() end
         if getgenv().FlyConnection then getgenv().FlyConnection:Disconnect() end
         getgenv().lastVelocity = nil
      end
   end,
})

Tab:CreateSlider({
   Name = "Walkspeed",
   Range = {16, 200},
   Increment = 1,
   CurrentValue = 16,
   Flag = "WalkspeedSlider",
   Callback = function(Value)
      local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
      if humanoid then humanoid.WalkSpeed = Value end
   end,
})

-- GAME DETECTION NOTIFICATION
if isStealABrainrot() then
   Rayfield:Notify({
      Title = "ðŸ§  Steal a Brainrot Detected!",
      Content = "Brainrot tab loaded with Auto Steal!",
      Duration = 5
   })
else
   Rayfield:Notify({
      Title = "ðŸ”¥ FlareHub V2 Loaded",
      Content = "Smooth fly + universal features ready!",
      Duration = 3
   })
end
