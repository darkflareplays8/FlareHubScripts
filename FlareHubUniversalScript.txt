local lastSpeed = 16
local targetSpeed = 16

local function safeSetWalkspeed(humanoid, speed)
    targetSpeed = math.clamp(speed, 16, 50) -- safe max cap but adjustable
    
    spawn(function()
        while math.abs(humanoid.WalkSpeed - targetSpeed) > 0.5 do
            local newSpeed = humanoid.WalkSpeed + (targetSpeed - humanoid.WalkSpeed) * 0.1
            -- Add tiny random noise between -0.5 and 0.5
            newSpeed = newSpeed + math.random(-5,5) * 0.1
            newSpeed = math.clamp(newSpeed, 16, 50)
            humanoid.WalkSpeed = newSpeed
            wait(0.15)
        end
        humanoid.WalkSpeed = targetSpeed -- stabilize final speed
    end)
end

-- Example usage in callback
Tab:CreateSlider({
   Name = "Walkspeed",
   Range = {16, 50},
   Increment = 1,
   CurrentValue = 16,
   Flag = "WalkspeedSlider",
   Callback = function(Value)
      local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
      if humanoid then
         safeSetWalkspeed(humanoid, Value)
      end
   end,
})
