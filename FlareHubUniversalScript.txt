-- üî• FlareHub V2 - COMPLETE MULTI-GAME HUB
getgenv().SecureMode = true

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
Rayfield:LoadConfiguration()

local Window = Rayfield:CreateWindow({
   Name = "üî• FlareHub V2",
   LoadingTitle = "FlareHub V2",
   LoadingSubtitle = "Noclip ‚Ä¢ Fly ‚Ä¢ ESP ‚Ä¢ Walkspeed ‚Ä¢ SAB ‚Ä¢ 99 Nights",
   ConfigurationSaving = { Enabled = true, FolderName = "FlareHub", FileName = "FlareConfig" },
   Discord = { Enabled = false },
   KeySystem = false
})

local MainTab = Window:CreateTab("üéÆ Main", 4483362458)
local SABTab
local NightsTab

local player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
task.wait(1)

-- AUTHORIZED USER CHECK
local function isAuthorized()
   return player.Name == "DarealBloxfruiter"
end

-- GAME DETECTION
local function detectGame()
   local success, result = pcall(function()
      return game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name:lower()
   end)
   if success then
      local gameName = result:lower()
      if gameName:find("steal") and gameName:find("brainrot") then return "SAB" end
      if gameName:find("night") and (gameName:find("forest") or gameName:find("99")) then return "99NIGHTS" end
   end
   return "UNIVERSAL"
end

local currentGame = detectGame()

-- ULTRA SAFE WALKSPD
local function safeSetWalkspeed(humanoid, speed)
   local targetSpeed = math.clamp(speed, 16, 24)
   spawn(function()
      while math.abs(humanoid.WalkSpeed - targetSpeed) > 0.1 do
         local newSpeed = humanoid.WalkSpeed + (targetSpeed - humanoid.WalkSpeed) * 0.03
         newSpeed = newSpeed + math.random(-1, 1) * 0.03
         humanoid.WalkSpeed = math.clamp(newSpeed, 16, 24)
         wait(0.4)
      end
   end)
end

-- TRUE GODMODE
local godmodeConnection
local function toggleGodmode(Value)
   if not player.Character then return end
   local humanoid = player.Character:FindFirstChild("Humanoid")
   if not humanoid then return end
   
   if Value then
      godmodeConnection = humanoid.HealthChanged:Connect(function(health)
         if health < humanoid.MaxHealth then
            humanoid.Health = humanoid.MaxHealth
         end
      end)
   else
      if godmodeConnection then godmodeConnection:Disconnect() end
   end
end

-- üéÆ MAIN TAB CONTENT (from your original script)
local MovementSection = MainTab:CreateSection("üèÉ Movement")

MainTab:CreateToggle({
   Name = "Noclip",
   CurrentValue = false,
   Flag = "NoclipMain",
   Callback = function(Value)
      local character = player.Character
      if character then
         local humanoid = character:FindFirstChild("Humanoid")
         if humanoid then humanoid.PlatformStand = Value end
      end
   end
})

MainTab:CreateSlider({
   Name = "Walkspeed",
   Range = {16, 50},
   Increment = 1,
   Suffix = "Speed",
   CurrentValue = 16,
   Flag = "WalkspeedMain",
   Callback = function(Value)
      local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
      if humanoid then safeSetWalkspeed(humanoid, Value) end
   end
})

MainTab:CreateToggle({
   Name = "Godmode",
   CurrentValue = false,
   Flag = "GodmodeMain",
   Callback = toggleGodmode
})

-- üå≤ 99 NIGHTS TAB - GAME SPECIFIC
if currentGame == "99NIGHTS" then
   NightsTab = Window:CreateTab("üå≤ 99 Nights", 1398837429)
   
   local BringSection = NightsTab:CreateSection("üì¶ Bring Items")
   
   -- BETTER 99 NIGHTS PICKUP FILTER
   local function isPickupItem(obj)
      if not obj:IsA("BasePart") or obj.Size.Magnitude < 0.5 then return false end
      if obj.Parent == player.Character then return false end
      
      local name = obj.Name:lower()
      local goodItems = {"wood", "log", "coal", "morsel", "bandage", "apple", "berry", "carrot", "diamond", "scrap", "metal", "seed"}
      local badItems = {"particle", "effect", "scrapper", "light", "fire", "smoke", "debris", "chunk"}
      
      for _, bad in pairs(badItems) do
         if name:find(bad) then return false end
      end
      
      for _, good in pairs(goodItems) do
         if name:find(good) then return true end
      end
      
      return false
   end
   
   local function scanPickupItems()
      local items = {}
      local seen = {}
      for _, obj in pairs(workspace:GetChildren()) do
         if isPickupItem(obj) and not seen[obj.Name] then
            seen[obj.Name] = true
            table.insert(items, obj.Name)
         end
      end
      table.sort(items)
      return items
   end
   
   local Dropdown
   local function updateDropdown()
      local items = scanPickupItems()
      if #items > 0 then
         Dropdown:Refresh(items, true)
         Dropdown:Set(items[1])
      else
         Dropdown:Refresh({"No items"}, true)
      end
   end
   
   NightsTab:CreateButton({
      Name = "üîç Scan Items",
      Callback = function()
         updateDropdown()
         Rayfield:Notify({Title = "Scan", Content = #scanPickupItems() .. " items!", Duration = 2})
      end
   })
   
   Dropdown = NightsTab:CreateDropdown({
      Name = "üéØ Bring Item",
      Options = {"Scan first"},
      CurrentValue = {"Scan first"},
      Flag = "Bring99Nights",
      Callback = function(Option)
         if Option[1] == "Scan first" or Option[1] == "No items" then return end
         
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if not root then return end
         
         local count = 0
         for _, obj in pairs(workspace:GetChildren()) do
            if isPickupItem(obj) and obj.Name == Option[1] then
               obj.CFrame = root.CFrame * CFrame.new(0, 3, -5)
               count = count + 1
            end
         end
         Rayfield:Notify({Title = "Done", Content = count .. " " .. Option[1], Duration = 2})
      end
   })
   
   -- ORIGINAL QUICK BUTTONS
   NightsTab:CreateButton({
      Name = "üì¶ Bring All Wood",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            for _, item in pairs(workspace:GetDescendants()) do
               if item:IsA("BasePart") and item.Name:lower():find("wood") then
                  item.CFrame = root.CFrame * CFrame.new(0, 0, -3)
                  count = count + 1
               end
            end
            Rayfield:Notify({Title = "Bring", Content = "Brought " .. count .. " wood!", Duration = 3})
         end
      end,
   })
   
   NightsTab:CreateButton({
      Name = "üçé Bring All Food",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            for _, item in pairs(workspace:GetDescendants()) do
               if item:IsA("BasePart") and item.Name:lower():find("food") then
                  item.CFrame = root.CFrame * CFrame.new(2, 0, -3)
                  count = count + 1
               end
            end
            Rayfield:Notify({Title = "Bring", Content = "Brought " .. count .. " food!", Duration = 3})
         end
      end,
   })
   
   NightsTab:CreateButton({
      Name = "üíé Bring All Diamonds",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            for _, item in pairs(workspace:GetDescendants()) do
               if item:IsA("BasePart") and item.Name:lower():find("diamond") then
                  item.CFrame = root.CFrame * CFrame.new(-2, 0, -3)
                  count = count + 1
               end
            end
            Rayfield:Notify({Title = "Bring", Content = "Brought " .. count .. " diamonds!", Duration = 3})
         end
      end,
   })

   local TeleportSection = NightsTab:CreateSection("üöÄ Teleport")
   NightsTab:CreateButton({
      Name = "üèïÔ∏è TP to Base",
      Callback = function()
         for _, base in pairs(workspace:GetDescendants()) do
            if base.Name:lower():find("base") and base:IsA("BasePart") then
               player.Character.HumanoidRootPart.CFrame = base.CFrame + Vector3.new(0, 5, 0)
               break
            end
         end
      end,
   })
   NightsTab:CreateButton({
      Name = "üå≥ TP to Trees",
      Callback = function()
         for _, tree in pairs(workspace:GetDescendants()) do
            if tree.Name:lower():find("tree") and tree:IsA("BasePart") then
               player.Character.HumanoidRootPart.CFrame = tree.CFrame + Vector3.new(0, 5, 0)
               break
            end
         end
         Rayfield:Notify({Title = "Teleport", Content = "Teleported to trees!", Duration = 2})
      end,
   })
end

print("üî• FlareHub V2 loaded successfully!")
