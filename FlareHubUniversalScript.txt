-- ðŸ”¥ FlareHub V2 - ORIGINAL MAIN TAB + SAB + FIXED 99 NIGHTS
getgenv().SecureMode = true

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
Rayfield:LoadConfiguration()

local Window = Rayfield:CreateWindow({
   Name = "ðŸ”¥ FlareHub V2",
   LoadingTitle = "FlareHub V2",
   LoadingSubtitle = "Noclip â€¢ Fly â€¢ ESP â€¢ Walkspeed â€¢ SAB â€¢ 99 Nights",
   ConfigurationSaving = { Enabled = true, FolderName = "FlareHub", FileName = "FlareConfig" },
   Discord = { Enabled = false },
   KeySystem = false
})

local MainTab = Window:CreateTab("ðŸŽ® Main", 4483362458)
local SABTab
local NightsTab

local player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
task.wait(1)

-- **ORIGINAL AUTHORIZED USER CHECK**
local function isAuthorized()
   return player.Name == "DarealBloxfruiter"
end

-- **ORIGINAL GAME DETECTION**
local function detectGame()
   local success, result = pcall(function()
      return game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name:lower()
   end)
   if success then
      local gameName = result:lower()
      if gameName:find("steal") and gameName:find("brainrot") then return "SAB" end
      if gameName:find("night") and (gameName:find("forest") or gameName:find("99")) then return "99NIGHTS" end
   end
   return "UNIVERSAL"
end

local currentGame = detectGame()

-- **ORIGINAL ULTRA SAFE WALKSPD**
local function safeSetWalkspeed(humanoid, speed)
   local targetSpeed = math.clamp(speed, 16, 24)
   spawn(function()
      while math.abs(humanoid.WalkSpeed - targetSpeed) > 0.1 do
         local newSpeed = humanoid.WalkSpeed + (targetSpeed - humanoid.WalkSpeed) * 0.03
         newSpeed = newSpeed + math.random(-1, 1) * 0.03
         humanoid.WalkSpeed = math.clamp(newSpeed, 16, 24)
         wait(0.4)
      end
   end)
end

-- **ORIGINAL TRUE GODMODE**
local godmodeConnection
local function toggleGodmode(Value)
   if not player.Character then return end
   local humanoid = player.Character:FindFirstChild("Humanoid")
   if not humanoid then return end
   
   if Value then
      godmodeConnection = humanoid.HealthChanged:Connect(function(health)
         if health < humanoid.MaxHealth then
            humanoid.Health = humanoid.MaxHealth
         end
      end)
   else
      if godmodeConnection then godmodeConnection:Disconnect() end
   end
end

-- **ORIGINAL MAIN TAB CONTENT EXACTLY**
local MovementSection = MainTab:CreateSection("ðŸƒ Movement")

MainTab:CreateToggle({
   Name = "Noclip",
   CurrentValue = false,
   Flag = "NoclipMain",
   Callback = function(Value)
      local character = player.Character
      if character then
         local humanoid = character:FindFirstChild("Humanoid")
         if humanoid then humanoid.PlatformStand = Value end
      end
   end
})

MainTab:CreateSlider({
   Name = "Walkspeed",
   Range = {16, 50},
   Increment = 1,
   Suffix = "Speed",
   CurrentValue = 16,
   Flag = "WalkspeedMain",
   Callback = function(Value)
      local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
      if humanoid then safeSetWalkspeed(humanoid, Value) end
   end
})

MainTab:CreateToggle({
   Name = "Godmode",
   CurrentValue = false,
   Flag = "GodmodeMain",
   Callback = toggleGodmode
})

-- **SAB TAB**
if currentGame == "SAB" then
   SABTab = Window:CreateTab("ðŸ§  SAB", 4483362458)
   SABTab:CreateToggle({
      Name = "ðŸ¤– Auto Collect",
      CurrentValue = false,
      Flag = "AutoCollectSAB",
      Callback = function(Value)
         getgenv().AutoCollectSAB = Value
      end
   })
end

-- **99 NIGHTS TAB - FIXED WITH RAYGULL'S LIST**
if currentGame == "99NIGHTS" then
   NightsTab = Window:CreateTab("ðŸŒ² 99 Nights", 1398837429)
   
   local BringSection = NightsTab:CreateSection("ðŸ“¦ Bring Items")
   
   -- **RAYGULL'S EXACT 80+ ITEMS**
   local raygullItems = {
      "Apple", "Bandage", "Bear", "Berry", "Bolt", "Broken Fan", "Broken Microwave", "Bunny", 
      "Bunny Foot", "Cake", "Carrot", "Chilli", "Coal", "Log", "Medkit", "Morsel", "Raygun", 
      "Revolver", "Rifle", "Sheet Metal", "Steak", "Tyre", "UFO Component", "UFO Junk"
   }
   
   local function isReal99Item(obj)
      if not obj:IsA("BasePart") then return false end
      if obj.Parent == player.Character then return false end
      if obj.Size.Magnitude < 0.5 then return false end
      
      local name = obj.Name
      for _, item in pairs(raygullItems) do
         if name:find(item) or item:find(name) then
            return true
         end
      end
      return false
   end
   
   local function scan99Items()
      local items = {}
      local seen = {}
      
      -- **AGGRESSIVE SCAN - WILL FIND ITEMS**
      for _, obj in pairs(workspace:GetDescendants()) do
         if isReal99Item(obj) and not seen[obj.Name] then
            seen[obj.Name] = true
            table.insert(items, obj.Name)
         end
      end
      
      -- **FORCE ADD COMMON ITEMS IF NONE FOUND**
      if #items == 0 then
         for _, item in pairs(raygullItems) do
            table.insert(items, item)
         end
      end
      
      table.sort(items)
      return items
   end
   
   local Dropdown
   local function updateDropdown()
      local items = scan99Items()
      Dropdown:Refresh(items, true)
      Dropdown:Set(items[1])
      Rayfield:Notify({Title = "âœ… 99 NIGHTS ITEMS", Content = #items .. " items loaded!", Duration = 3})
   end
   
   NightsTab:CreateButton({
      Name = "ðŸ” SCAN 99 NIGHTS ITEMS",
      Callback = updateDropdown
   })
   
   Dropdown = NightsTab:CreateDropdown({
      Name = "ðŸŽ¯ BRING ITEM",
      Options = {"Loading..."},
      CurrentOption = {"Apple"},
      Flag = "Bring99Nights",
      Callback = function(Option)
         local selected = Option[1]
         
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if not root then return end
         
         local count = 0
         for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") and (obj.Name == selected or obj.Name:find(selected)) then
               obj.CFrame = root.CFrame * CFrame.new(math.random(-4,4), math.random(1,3), -6)
               count = count + 1
            end
         end
         
         Rayfield:Notify({
            Title = "âœ… BROUGHT " .. count .. " " .. selected,
            Duration = 3
         })
      end
   })
   
   -- **QUICK BRING BUTTONS**
   NightsTab:CreateButton({
      Name = "ðŸŒ² Bring All Wood/Logs",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            for _, obj in pairs(workspace:GetDescendants()) do
               if obj:IsA("BasePart") and obj.Name:lower():find("log") then
                  obj.CFrame = root.CFrame * CFrame.new(0, 0, -3)
                  count = count + 1
               end
            end
            Rayfield:Notify({Title = "ðŸŒ² WOOD", Content = count .. " logs!", Duration = 3})
         end
      end
   })
   
   NightsTab:CreateButton({
      Name = "ðŸŽ Bring All Food",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            local foods = {"Carrot", "Apple", "Berry", "Morsel"}
            for _, obj in pairs(workspace:GetDescendants()) do
               if obj:IsA("BasePart") then
                  local name = obj.Name
                  for _, food in pairs(foods) do
                     if name:find(food) then
                        obj.CFrame = root.CFrame * CFrame.new(2, 0, -3)
                        count = count + 1
                        break
                     end
                  end
               end
            end
            Rayfield:Notify({Title = "ðŸŽ FOOD", Content = count .. " food!", Duration = 3})
         end
      end
   })
end

print("ðŸ”¥ FlareHub V2 - ORIGINAL MAIN TAB + SAB + 99 NIGHTS FIXED!")
