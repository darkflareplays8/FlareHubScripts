-- üî• FlareHub V2 - RAYGULL 99 NIGHTS + FULL MAIN TAB
getgenv().SecureMode = true

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
Rayfield:LoadConfiguration()

local Window = Rayfield:CreateWindow({
   Name = "üî• FlareHub V2",
   LoadingTitle = "FlareHub V2",
   LoadingSubtitle = "Noclip ‚Ä¢ Fly ‚Ä¢ ESP ‚Ä¢ Walkspeed ‚Ä¢ SAB ‚Ä¢ 99 Nights",
   ConfigurationSaving = { Enabled = true, FolderName = "FlareHub", FileName = "FlareConfig" },
   Discord = { Enabled = false },
   KeySystem = false
})

local MainTab = Window:CreateTab("Main", 4483362458)
local NightsTab
local player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
task.wait(1)

-- **RAYGULL'S ACTUAL 99 NIGHTS ITEMS** [web:13]
local teleportTargets = {
    "Alien", "Alien Chest", "Alien Shelf", "Alpha Wolf", "Alpha Wolf Pelt", "Anvil Base", "Apple", "Bandage", 
    "Bear", "Berry", "Bolt", "Broken Fan", "Broken Microwave", "Bunny", "Bunny Foot", "Cake", "Carrot", 
    "Chair Set", "Chest", "Chilli", "Coal", "Coin Stack", "Crossbow Cultist", "Cultist", "Cultist Gem", 
    "Deer", "Fuel Canister", "Giant Sack", "Good Axe", "Iron Body", "Item Chest", "Item Chest2", 
    "Item Chest3", "Item Chest4", "Item Chest6", "Laser Fence Blueprint", "Laser Sword", "Leather Body", 
    "Log", "Lost Child", "Lost Child2", "Lost Child3", "Lost Child4", "Medkit", "Meat? Sandwich", 
    "Morsel", "Old Car Engine", "Old Flashlight", "Old Radio", "Oil Barrel", "Raygun", "Revolver", 
    "Revolver Ammo", "Rifle", "Rifle Ammo", "Riot Shield", "Sapling", "Seed Box", "Sheet Metal", 
    "Spear", "Steak", "Stronghold Diamond Chest", "Tyre", "UFO Component", "UFO Junk", 
    "Washing Machine", "Wolf", "Wolf Corpse", "Wolf Pelt"
}

-- GAME DETECTION
local function detectGame()
   local success, result = pcall(function()
      return game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name:lower()
   end)
   if success then
      local gameName = result:lower()
      if gameName:find("steal") and gameName:find("brainrot") then return "SAB" end
      if gameName:find("night") and (gameName:find("forest") or gameName:find("99")) then return "99NIGHTS" end
   end
   return "UNIVERSAL"
end

local currentGame = detectGame()

-- **SAFE WALKSPD FROM BRAINROT SCRIPT**
local function safeSetWalkspeed(humanoid, speed)
   local targetSpeed = math.clamp(speed, 16, 50)
   spawn(function()
      while math.abs(humanoid.WalkSpeed - targetSpeed) > 0.5 do
         local newSpeed = humanoid.WalkSpeed + (targetSpeed - humanoid.WalkSpeed) * 0.1
         newSpeed = newSpeed + math.random(-5, 5) * 0.1
         newSpeed = math.clamp(newSpeed, 16, 50)
         humanoid.WalkSpeed = newSpeed
         wait(0.15)
      end
      humanoid.WalkSpeed = targetSpeed
   end)
end

-- **SAFE HITBOX SPACE FROM BRAINROT SCRIPT**
getgenv().spaceHitboxEnabled = false
local spaceConnection
local function toggleSpaceHitbox(Value)
   getgenv().spaceHitboxEnabled = Value
   
   if Value and player.Character then
      local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
      if rootPart then
         spawn(function()
            for i = 1, 50 do
               rootPart.CFrame = rootPart.CFrame + Vector3.new(0, 20, 0)
               wait(0.05)
            end
         end)
         
         spaceConnection = RunService.Heartbeat:Connect(function()
            if player.Character and rootPart.Parent then
               local camera = workspace.CurrentCamera
               local head = player.Character:FindFirstChild("Head")
               if head then
                  camera.CFrame = CFrame.new(head.Position, head.Position + camera.CFrame.LookVector)
               end
            end
         end)
      end
   else
      if spaceConnection then spaceConnection:Disconnect() end
      
      if player.Character then
         local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
         if rootPart then
            spawn(function()
               for i = 1, 50 do
                  rootPart.CFrame = rootPart.CFrame - Vector3.new(0, 20, 0)
                  wait(0.05)
               end
            end)
         end
      end
   end
end

-- **COMPLETE MAIN TAB FROM BRAINROT SCRIPT**
MainTab:CreateButton({ 
   Name = "‚úÖ Test GUI", 
   Callback = function() 
      print("FlareHub V2 loaded!") 
      Rayfield:Notify({Title = "FlareHub", Content = "Loaded successfully!", Duration = 3})
   end 
})

MainTab:CreateToggle({
   Name = "üåå Safe Hitbox Space",
   CurrentValue = false,
   Flag = "SpaceHitboxToggle",
   Callback = toggleSpaceHitbox
})

MainTab:CreateToggle({
   Name = "‚ú® Noclip",
   CurrentValue = false,
   Flag = "NoclipToggle",
   Callback = function(Value)
      getgenv().NoclipEnabled = Value
      if Value then
         getgenv().NoclipConnection = RunService.Stepped:Connect(function()
            if player.Character then
               for _, part in pairs(player.Character:GetDescendants()) do
                  if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                     part.CanCollide = false
                  end
               end
            end
         end)
      else 
         if getgenv().NoclipConnection then getgenv().NoclipConnection:Disconnect() end
      end
   end,
})

MainTab:CreateSlider({
   Name = "Fly Speed",
   Range = {50, 300},
   Increment = 10,
   CurrentValue = 100,
   Flag = "FlySpeedSlider",
   Callback = function(Value) getgenv().FlySpeed = Value end,
})

MainTab:CreateToggle({
   Name = "üïäÔ∏è Fly",
   CurrentValue = false,
   Flag = "FlyToggle",
   Callback = function(Value)
      getgenv().FlyEnabled = Value
      local character = player.Character or player.CharacterAdded:Wait()
      local humanoid = character:WaitForChild("Humanoid")
      local rootPart = character:WaitForChild("HumanoidRootPart")
      
      if Value then
         humanoid.PlatformStand = true
         rootPart.CFrame = rootPart.CFrame + Vector3.new(0, 10, 0)
         
         local bodyVelocity = Instance.new("BodyVelocity")
         bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
         bodyVelocity.Velocity = Vector3.new(0, 0, 0)
         bodyVelocity.Parent = rootPart
         
         local bodyGyro = Instance.new("BodyGyro")
         bodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
         bodyGyro.P = 3000
         bodyGyro.D = 500
         bodyGyro.CFrame = rootPart.CFrame
         bodyGyro.Parent = rootPart
         
         getgenv().FlyBodyVelocity = bodyVelocity
         getgenv().FlyBodyGyro = bodyGyro
         getgenv().lastVelocity = Vector3.new(0, 0, 0)
         
         getgenv().FlyConnection = RunService.Heartbeat:Connect(function()
            if not rootPart.Parent then return end
            
            local camera = workspace.CurrentCamera
            local camCFrame = camera.CFrame
            local moveDir = humanoid.MoveDirection
            local speed = getgenv().FlySpeed or 100
            
            local horizontalForward = Vector3.new(camCFrame.LookVector.X, 0, camCFrame.LookVector.Z)
            if horizontalForward.Magnitude > 0 then
               horizontalForward = horizontalForward.Unit
            else
               horizontalForward = Vector3.new(0, 0, -1)
            end
            
            local camRight = Vector3.new(camCFrame.RightVector.X, 0, camCFrame.RightVector.Z).Unit
            
            if moveDir.Magnitude > 0.05 then
               local horizontalMove = horizontalForward * -moveDir.Z + camRight * moveDir.X
               local verticalMove = Vector3.new(0, moveDir.Y * speed, 0)
               local targetVelocity = (horizontalMove * speed) + verticalMove
               
               local currentVelocity = getgenv().lastVelocity or Vector3.new(0, 0, 0)
               local lerpVelocity = currentVelocity:Lerp(targetVelocity, 0.15)
               
               bodyVelocity.Velocity = lerpVelocity
               getgenv().lastVelocity = lerpVelocity
            else
               local currentVelocity = getgenv().lastVelocity or Vector3.new(0, 0, 0)
               local lerpVelocity = currentVelocity:Lerp(Vector3.new(0, 0, 0), 0.15)
               
               bodyVelocity.Velocity = lerpVelocity
               getgenv().lastVelocity = lerpVelocity
            end
            
            bodyGyro.CFrame = CFrame.new(rootPart.Position, rootPart.Position + camCFrame.LookVector)
         end)
         
      else
         humanoid.PlatformStand = false
         if getgenv().FlyBodyVelocity then getgenv().FlyBodyVelocity:Destroy() end
         if getgenv().FlyBodyGyro then getgenv().FlyBodyGyro:Destroy() end
         if getgenv().FlyConnection then getgenv().FlyConnection:Disconnect() end
         getgenv().lastVelocity = nil
      end
   end,
})

MainTab:CreateSlider({
   Name = "Walkspeed (Safe)",
   Range = {16, 50},
   Increment = 1,
   CurrentValue = 16,
   Flag = "WalkspeedSlider",
   Callback = function(Value)
      local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
      if humanoid then safeSetWalkspeed(humanoid, Value) end
   end,
})

-- **99 NIGHTS TAB WITH FIXED SCAN**
if currentGame == "99NIGHTS" then
   NightsTab = Window:CreateTab("üå≤ 99 Nights", 1398837429)
   
   local BringSection = NightsTab:CreateSection("üì¶ Bring REAL Items")
   
   -- **RAYGULL PICKABLE FILTER - FIXED SCAN**
   local function isPickableItem(obj)
      if not obj:IsA("BasePart") then return false end
      if obj.Size.Magnitude < 0.3 or obj.Size.Magnitude > 25 then return false end
      if obj.Parent == player.Character then return false end
      
      local name = obj.Name
      -- **MATCH RAYGULL'S EXACT LIST**
      for _, targetName in pairs(teleportTargets) do
         if name == targetName or name:lower():find(targetName:lower()) or targetName:lower():find(name:lower()) then
            return true
         end
      end
      return false
   end
   
   local function scanPickableItems()
      local foundItems = {}
      local seen = {}
      
      -- **SCAN ALL WORKSPACE - WILL FIND ITEMS NOW**
      for _, obj in pairs(workspace:GetDescendants()) do  -- Changed back to GetDescendants
         if isPickableItem(obj) and not seen[obj.Name] then
            seen[obj.Name] = true
            table.insert(foundItems, obj.Name)
         end
      end
      
      table.sort(foundItems)
      return foundItems
   end
   
   local Dropdown
   local function updateDropdown()
      local items = scanPickableItems()
      if #items > 0 then
         Dropdown:Refresh(items, true)
         Dropdown:Set(items[1])
         Rayfield:Notify({Title = "‚úÖ FOUND ITEMS", Content = #items .. " real items (Carrot, Log, etc.)", Duration = 3})
      else
         Dropdown:Refresh({"No items found"}, true)
      end
   end
   
   NightsTab:CreateButton({
      Name = "üîç Scan All Items",
      Callback = updateDropdown
   })
   
   Dropdown = NightsTab:CreateDropdown({
      Name = "üéØ Bring Item",
      Options = {"Scan first"},
      CurrentOption = {"Scan first"},
      Flag = "Bring99Nights",
      Callback = function(Option)
         local selected = Option[1]
         if selected == "Scan first" or selected == "No items found" then return end
         
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if not root then return end
         
         local count = 0
         for _, obj in pairs(workspace:GetDescendants()) do
            if isPickableItem(obj) and obj.Name == selected then
               obj.CFrame = root.CFrame * CFrame.new(math.random(-3,3), 2, -5)
               count = count + 1
            end
         end
         Rayfield:Notify({Title = "‚úÖ BROUGHT", Content = count .. " " .. selected, Duration = 3})
      end
   })
   
   -- QUICK BUTTONS
   NightsTab:CreateButton({
      Name = "üçé Bring Food",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            local foods = {"Carrot", "Apple", "Berry", "Morsel", "Steak"}
            for _, obj in pairs(workspace:GetDescendants()) do
               if isPickableItem(obj) then
                  for _, food in pairs(foods) do
                     if obj.Name:find(food) then
                        obj.CFrame = root.CFrame * CFrame.new(2, 2, -4)
                        count = count + 1
                        break
                     end
                  end
               end
            end
            Rayfield:Notify({Title = "üçé FOOD", Content = count .. " food!", Duration = 2})
         end
      end
   })
end

print("üî• FlareHub V2 - FULL MAIN TAB + FIXED 99 NIGHTS!")
