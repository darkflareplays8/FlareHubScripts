-- üî• FlareHub V2 - COMPLETE MULTI-GAME HUB
getgenv().SecureMode = true

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
Rayfield:LoadConfiguration()

local Window = Rayfield:CreateWindow({
   Name = "üî• FlareHub V2",
   LoadingTitle = "FlareHub V2",
   LoadingSubtitle = "Noclip ‚Ä¢ Fly ‚Ä¢ ESP ‚Ä¢ Walkspeed ‚Ä¢ SAB ‚Ä¢ 99 Nights",
   ConfigurationSaving = { Enabled = true, FolderName = "FlareHub", FileName = "FlareConfig" },
   Discord = { Enabled = false },
   KeySystem = false
})

local MainTab = Window:CreateTab("üéÆ Main", 4483362458)
local SABTab
local NightsTab

local player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
task.wait(1)

-- AUTHORIZED USER CHECK
local function isAuthorized()
   return player.Name == "DarealBloxfruiter"
end

-- GAME DETECTION
local function detectGame()
   local success, result = pcall(function()
      return game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name:lower()
   end)
   if success then
      local gameName = result:lower()
      if gameName:find("steal") and gameName:find("brainrot") then return "SAB" end
      if gameName:find("night") and (gameName:find("forest") or gameName:find("99")) then return "99NIGHTS" end
   end
   return "UNIVERSAL"
end

local currentGame = detectGame()

-- ULTRA SAFE WALKSPD
local function safeSetWalkspeed(humanoid, speed)
   local targetSpeed = math.clamp(speed, 16, 24)
   spawn(function()
      while math.abs(humanoid.WalkSpeed - targetSpeed) > 0.1 do
         local newSpeed = humanoid.WalkSpeed + (targetSpeed - humanoid.WalkSpeed) * 0.03
         newSpeed = newSpeed + math.random(-1, 1) * 0.03
         humanoid.WalkSpeed = math.clamp(newSpeed, 16, 24)
         wait(0.4)
      end
   end)
end

-- TRUE GODMODE
local godmodeConnection
local function toggleGodmode(Value)
   if not player.Character then return end
   local humanoid = player.Character:FindFirstChild("Humanoid")
   if not humanoid then return end
   
   if Value then
      godmodeConnection = humanoid.HealthChanged:Connect(function(health)
         if health < humanoid.MaxHealth then
            humanoid.Health = humanoid.MaxHealth
         end
      end)
   else
      if godmodeConnection then godmodeConnection:Disconnect() end
   end
end

-- üéÆ MAIN TAB CONTENT
local MovementSection = MainTab:CreateSection("üèÉ Movement")

MainTab:CreateToggle({
   Name = "Noclip",
   CurrentValue = false,
   Flag = "NoclipMain",
   Callback = function(Value)
      local character = player.Character
      if character then
         local humanoid = character:FindFirstChild("Humanoid")
         if humanoid then humanoid.PlatformStand = Value end
      end
   end
})

MainTab:CreateSlider({
   Name = "Walkspeed",
   Range = {16, 50},
   Increment = 1,
   Suffix = "Speed",
   CurrentValue = 16,
   Flag = "WalkspeedMain",
   Callback = function(Value)
      local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
      if humanoid then safeSetWalkspeed(humanoid, Value) end
   end
})

MainTab:CreateToggle({
   Name = "Godmode",
   CurrentValue = false,
   Flag = "GodmodeMain",
   Callback = toggleGodmode
})

-- üå≤ 99 NIGHTS TAB - GAME SPECIFIC
if currentGame == "99NIGHTS" then
   NightsTab = Window:CreateTab("üå≤ 99 Nights", 1398837429)
   
   local BringSection = NightsTab:CreateSection("üì¶ Bring Items")
   
   -- COMPLETE 99 NIGHTS ITEM LIST [web:1]
   local all99Items = {
      -- FOOD ITEMS
      "Apple", "BBQ Ribs", "Berry", "Cake", "Candy Apple", "Candy Corn", "Carrot", 
      "Carrot Cake", "Char", "Chili", "Clownfish", "Corn", "Cotton Candy", "Eel", 
      "Hearty Stew", "Jar o' Jelly", "Jellyfish", "Lava Eel", "Lionfish", "Mackerel",
      "Meat? Sandwich", "Morsel", "Pumpkin", "Pumpkin Pie", "Pumpkin Soup", "Ribs", 
      "Salmon", "Seafood Chowder", "Seasoning", "Shark", "Steak", "Steak Dinner", 
      "Stew", "Swordfish",
      
      -- SEEDS
      "Berry Seeds", "Cavevine Seeds", "Chili Seeds", "Dripleaf Seeds", "Firefly Seeds",
      "Flower Seeds", "Mandrake Seeds", "Moonflower Seeds", "Stareweed Seeds",
      
      -- TRIM KITS & MATERIALS
      "Armor Trim Kit", "Axe Trim Kit", "Wood", "Wood Log", "Scrap", "Sheet Metal", 
      "Tyre", "UFO Component", "UFO Scrap", "UFO Junk", "Washing Machine",
      
      -- HEALING & MEDICAL
      "Bandage", "Medkit", "First Aid",
      
      -- GUNS & WEAPONS (from wiki/categories)
      "Gun", "Pistol", "Rifle", "Shotgun", "Bear Trap", "Bolt",
      
      -- RESOURCES
      "Coal", "Diamond", "Gem", "Crystal"
   }
   
   -- FILTER FUNCTION FOR ACTUAL PICKUPS
   local function isValidPickup(obj)
      if not obj:IsA("BasePart") or obj.Size.Magnitude < 0.3 then return false end
      if obj.Parent == player.Character or not obj.Parent then return false end
      
      local name = obj.Name
      -- Check if matches any 99 Nights item
      for _, itemName in pairs(all99Items) do
         if name:lower():find(itemName:lower()) or itemName:lower():find(name:lower()) then
            -- Exclude obvious junk
            local junkWords = {"particle", "effect", "light", "fire", "smoke", "glow", "scrapper"}
            for _, junk in pairs(junkWords) do
               if name:lower():find(junk) then return false end
            end
            return true
         end
      end
      return false
   end
   
   local function scanRealItems()
      local foundItems = {}
      local seenNames = {}
      
      for _, obj in pairs(workspace:GetDescendants()) do
         if isValidPickup(obj) and not seenNames[obj.Name] then
            seenNames[obj.Name] = true
            table.insert(foundItems, obj.Name)
         end
      end
      
      table.sort(foundItems)
      return foundItems
   end
   
   local Dropdown
   local function updateItemList()
      local realItems = scanRealItems()
      if #realItems > 0 then
         Dropdown:Refresh(realItems, true)
         Dropdown:Set(realItems[1])
         Rayfield:Notify({Title = "Scan Complete", Content = #realItems .. " real items found!", Duration = 3})
      else
         Dropdown:Refresh({"No items found"}, true)
      end
   end
   
   -- SCAN BUTTON
   NightsTab:CreateButton({
      Name = "üîç Scan Real Items",
      Callback = function()
         updateItemList()
      end
   })
   
   -- DYNAMIC DROPDOWN
   Dropdown = NightsTab:CreateDropdown({
      Name = "üéØ Bring Item",
      Options = {"Scan first!"},
      CurrentOption = {"Scan first!"},
      Flag = "Bring99Nights",
      Callback = function(Option)
         local selected = Option[1]
         if selected == "Scan first!" or selected == "No items found" then return end
         
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if not root then return end
         
         local count = 0
         for _, obj in pairs(workspace:GetDescendants()) do
            if isValidPickup(obj) and obj.Name == selected then
               pcall(function()
                  obj.CFrame = root.CFrame * CFrame.new(math.random(-4,4), math.random(2,4), -6)
                  count = count + 1
               end)
            end
         end
         
         Rayfield:Notify({
            Title = "Bring Complete",
            Content = "Brought " .. count .. " " .. selected .. "!",
            Duration = 3
         })
      end
   })
   
   -- ORIGINAL QUICK BUTTONS (ENHANCED)
   NightsTab:CreateButton({
      Name = "üå≤ Bring All Wood/Logs",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            for _, item in pairs(workspace:GetDescendants()) do
               if isValidPickup(item) and item.Name:lower():find("wood") then
                  item.CFrame = root.CFrame * CFrame.new(0, 0, -3)
                  count = count + 1
               end
            end
            Rayfield:Notify({Title = "Wood", Content = count .. " wood brought!", Duration = 3})
         end
      end,
   })
   
   NightsTab:CreateButton({
      Name = "üçñ Bring All Food",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            local foodItems = {"apple", "berry", "morsel", "carrot", "steak", "ribs", "fish"}
            for _, item in pairs(workspace:GetDescendants()) do
               if isValidPickup(item) then
                  local name = item.Name:lower()
                  for _, food in pairs(foodItems) do
                     if name:find(food) then
                        item.CFrame = root.CFrame * CFrame.new(2, 0, -3)
                        count = count + 1
                        break
                     end
                  end
               end
            end
            Rayfield:Notify({Title = "Food", Content = count .. " food brought!", Duration = 3})
         end
      end,
   })
   
   NightsTab:CreateButton({
      Name = "üíé Bring All Diamonds",
      Callback = function()
         local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if root then
            local count = 0
            for _, item in pairs(workspace:GetDescendants()) do
               if isValidPickup(item) and item.Name:lower():find("diamond") then
                  item.CFrame = root.CFrame * CFrame.new(-2, 0, -3)
                  count = count + 1
               end
            end
            Rayfield:Notify({Title = "Diamonds", Content = count .. " diamonds brought!", Duration = 3})
         end
      end,
   })

   local TeleportSection = NightsTab:CreateSection("üöÄ Teleport")
   NightsTab:CreateButton({
      Name = "üèïÔ∏è TP to Base",
      Callback = function()
         for _, base in pairs(workspace:GetDescendants()) do
            if base.Name:lower():find("base") and base:IsA("BasePart") then
               player.Character.HumanoidRootPart.CFrame = base.CFrame + Vector3.new(0, 5, 0)
               break
            end
         end
      end,
   })
   NightsTab:CreateButton({
      Name = "üå≥ TP to Trees",
      Callback = function()
         for _, tree in pairs(workspace:GetDescendants()) do
            if tree.Name:lower():find("tree") and tree:IsA("BasePart") then
               player.Character.HumanoidRootPart.CFrame = tree.CFrame + Vector3.new(0, 5, 0)
               break
            end
         end
         Rayfield:Notify({Title = "Teleport", Content = "Teleported to trees!", Duration = 2})
      end,
   })
end

print("üî• FlareHub V2 loaded - COMPLETE 99 NIGHTS ITEMS!")
