-- üî• FlareHub V2 - COMPLETE MULTI-GAME HUB
getgenv().SecureMode = true

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
Rayfield:LoadConfiguration()

local Window = Rayfield:CreateWindow({
   Name = "üî• FlareHub V2",
   LoadingTitle = "FlareHub V2",
   LoadingSubtitle = "Noclip ‚Ä¢ Fly ‚Ä¢ ESP ‚Ä¢ Walkspeed ‚Ä¢ SAB ‚Ä¢ 99 Nights",
   ConfigurationSaving = { Enabled = true, FolderName = "FlareHub", FileName = "FlareConfig" },
   Discord = { Enabled = false },
   KeySystem = false
})

local MainTab = Window:CreateTab("üéÆ Main", 4483362458)
local SABTab
local NightsTab

local player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
task.wait(1)

-- AUTHORIZED USER CHECK
local function isAuthorized()
   return player.Name == "DarealBloxfruiter"
end

-- GAME DETECTION
local function detectGame()
   local success, result = pcall(function()
      return game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name:lower()
   end)
   if success then
      local gameName = result:lower()
      if gameName:find("steal") and gameName:find("brainrot") then return "SAB" end
      if gameName:find("night") and (gameName:find("forest") or gameName:find("99")) then return "99NIGHTS" end
   end
   return "UNIVERSAL"
end

local currentGame = detectGame()

-- ULTRA SAFE WALKSPD
local function safeSetWalkspeed(humanoid, speed)
   local targetSpeed = math.clamp(speed, 16, 24)
   spawn(function()
      while math.abs(humanoid.WalkSpeed - targetSpeed) > 0.1 do
         local newSpeed = humanoid.WalkSpeed + (targetSpeed - humanoid.WalkSpeed) * 0.03
         newSpeed = newSpeed + math.random(-1, 1) * 0.03
         humanoid.WalkSpeed = math.clamp(newSpeed, 16, 24)
         wait(0.4)
      end
   end)
end

-- TRUE GODMODE
local godmodeConnection
local function toggleGodmode(Value)
   if not player.Character then return end
   local humanoid = player.Character:FindFirstChild("Humanoid")
   if not humanoid then return end
   
   if Value then
      godmodeConnection = humanoid.HealthChanged:Connect(function(health)
         if health < humanoid.MaxHealth then
            humanoid.Health = humanoid.MaxHealth
         end
      end)
   else
      if godmodeConnection then godmodeConnection:Disconnect() end
   end
end

-- üå≤ 99 NIGHTS TAB - GAME SPECIFIC
if currentGame == "99NIGHTS" then
   NightsTab = Window:CreateTab("üå≤ 99 Nights", 1398837429)
   
   local BringSection = NightsTab:CreateSection("üì¶ Bring Items")
   
   -- DYNAMIC ITEM SCANNER
   local function scanWorkspaceItems()
      local items = {}
      local scannedNames = {}
      
      for _, obj in pairs(workspace:GetDescendants()) do
         if obj:IsA("BasePart") and obj.Name ~= "" and obj.Parent ~= player.Character then
            local name = obj.Name:lower()
            -- Filter for common 99 Nights items
            if name:find("wood") or name:find("food") or name:find("apple") or name:find("berry") or 
               name:find("diamond") or name:find("seed") or name:find("trim") or 
               name:find("metal") or name:find("scrap") or name:find("steak") or
               name:find("fish") or name:find("cake") or name:find("pumpkin") then
               if not scannedNames[name] then
                  scannedNames[name] = true
                  table.insert(items, obj.Name)
               end
            end
         end
      end
      
      table.sort(items)
      return items
   end
   
   local Dropdown
   local function updateItemDropdown()
      local items = scanWorkspaceItems()
      if #items > 0 then
         Dropdown:Refresh(items, true)
         Dropdown:Set(items[1])
      end
   end
   
   NightsTab:CreateButton({
      Name = "üîç Scan Items",
      Callback = function()
         updateItemDropdown()
         Rayfield:Notify({Title = "Scan Complete", Content = "Found " .. #scanWorkspaceItems() .. " item types!", Duration = 3})
      end
   })
   
   Dropdown = NightsTab:CreateDropdown({
      Name = "üéØ Bring Item",
      Options = {"Scanning..."},
      CurrentOption = "None",
      Flag = "BringItem99Nights",
      Callback = function(Option)
         if Option == "None" then return end
         
         local rootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if not rootPart then return end
         
         local brought = 0
         for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") and obj.Name == Option and obj.Parent ~= player.Character then
               pcall(function()
                  obj.CFrame = rootPart.CFrame * CFrame.new(math.random(-3,3), math.random(1,3), -5)
                  brought = brought + 1
               end)
            end
         end
         
         Rayfield:Notify({
            Title = "Bring Complete", 
            Content = "Brought " .. brought .. " " .. Option .. "!", 
            Duration = 3
         })
      end
   })
   
   -- Quick bring buttons (backup)
   NightsTab:CreateButton({
      Name = "üì¶ Bring All Wood",
      Callback = function()
         local rootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if not rootPart then return end
         
         local count = 0
         for _, item in pairs(workspace:GetDescendants()) do
            if item:IsA("BasePart") and item.Name:lower():find("wood") then
               item.CFrame = rootPart.CFrame * CFrame.new(0, 0, -3)
               count = count + 1
            end
         end
         Rayfield:Notify({Title = "Bring", Content = "Brought " .. count .. " wood!", Duration = 3})
      end,
   })
   
   NightsTab:CreateButton({
      Name = "üçé Bring All Food",
      Callback = function()
         local rootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if not rootPart then return end
         
         local count = 0
         for _, item in pairs(workspace:GetDescendants()) do
            local name = item.Name:lower()
            if item:IsA("BasePart") and (name:find("food") or name:find("apple") or name:find("berry") or 
               name:find("cake") or name:find("steak") or name:find("fish")) then
               item.CFrame = rootPart.CFrame * CFrame.new(2, 0, -3)
               count = count + 1
            end
         end
         Rayfield:Notify({Title = "Bring", Content = "Brought " .. count .. " food!", Duration = 3})
      end,
   })
   
   NightsTab:CreateButton({
      Name = "üíé Bring All Diamonds",
      Callback = function()
         local rootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
         if not rootPart then return end
         
         local count = 0
         for _, item in pairs(workspace:GetDescendants()) do
            if item:IsA("BasePart") and item.Name:lower():find("diamond") then
               item.CFrame = rootPart.CFrame * CFrame.new(-2, 0, -3)
               count = count + 1
            end
         end
         Rayfield:Notify({Title = "Bring", Content = "Brought " .. count .. " diamonds!", Duration = 3})
      end,
   })

   local TeleportSection = NightsTab:CreateSection("üöÄ Teleport")
   NightsTab:CreateButton({
      Name = "üèïÔ∏è TP to Base",
      Callback = function()
         for _, base in pairs(workspace:GetDescendants()) do
            if base.Name:lower():find("base") and base:IsA("BasePart") then
               player.Character.HumanoidRootPart.CFrame = base.CFrame + Vector3.new(0, 5, 0)
               break
            end
         end
      end,
   })
   
   NightsTab:CreateButton({
      Name = "üå≥ TP to Trees",
      Callback = function()
         for _, tree in pairs(workspace:GetDescendants()) do
            if tree.Name:lower():find("tree") and tree:IsA("BasePart") then
               player.Character.HumanoidRootPart.CFrame = tree.CFrame + Vector3.new(0, 5, 0)
               break
            end
         end
         Rayfield:Notify({Title = "Teleport", Content = "Teleported to trees!", Duration = 2})
      end,
   })
end

print("üî• FlareHub V2 loaded successfully!")
